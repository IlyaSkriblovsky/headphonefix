#include <stdio.h>
#include <string.h>

#include <unistd.h>
#include <sys/types.h>

unsigned char speaker_magic[] = {
0xbc, 0xc6, 0xc7, 0x4f, 0x4f, 0x68, 0x02, 0x00, 0x05, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00,
0xbc, 0xc6, 0xc7, 0x4f, 0x6e, 0x68, 0x02, 0x00, 0x05, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00,
0xbc, 0xc6, 0xc7, 0x4f, 0x6e, 0x68, 0x02, 0x00, 0x05, 0x00, 0x06, 0x00, 0x01, 0x00, 0x00, 0x00,
0xbc, 0xc6, 0xc7, 0x4f, 0x6e, 0x68, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};

unsigned char headphone_magic[] = {
0x4e, 0xc7, 0xc7, 0x4f, 0x1e, 0xa0, 0x0a, 0x00, 0x05, 0x00, 0x02, 0x00, 0x01, 0x00, 0x00, 0x00,
0x4e, 0xc7, 0xc7, 0x4f, 0xe2, 0xa4, 0x0a, 0x00, 0x05, 0x00, 0x04, 0x00, 0x01, 0x00, 0x00, 0x00,
0x4e, 0xc7, 0xc7, 0x4f, 0x01, 0xa5, 0x0a, 0x00, 0x05, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00,
0x4e, 0xc7, 0xc7, 0x4f, 0x01, 0xa5, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};


int usage() {
    fprintf(stderr, "Usage: switcher speaker|headphone\n");
    return 1;
}


int main(int argc, char *argv[])
{
    printf("my euid: %d\n", geteuid());
    printf("my egid: %d\n", getegid());

    if (argc != 2)
        return usage();

    if (strcmp(argv[1], "speaker") != 0  &&  strcmp(argv[1], "headphone") != 0)
        return usage();

    FILE *f = fopen("/dev/input/jack", "wb");

    if (f == 0) {
        fprintf(stderr, "Can't open device\n");
        return 2;
    }

    if (strcmp(argv[1], "speaker") == 0)
        fwrite(speaker_magic, sizeof(speaker_magic), 1, f);
    else if (strcmp(argv[1], "headphone") == 0)
        fwrite(headphone_magic, sizeof(headphone_magic), 1, f);

    fclose(f);

    return 0;
}
